<launch>
	<group ns="stereo">
		<node pkg="uvc_camera" type="uvc_camera_node" name="left">
		    <remap from="image_raw" to="left/image_raw" />
		    <remap from="camera_info" to="left/camera_info" />
		    <remap from="camera" to="left" />

			<param name="device" value="/dev/video1"/>
			<param name="camera_info_url" value="file://$(find carrt_goggles)/launch/left.yaml"/>

			<param name="width" value="1280"/>
			<param name="height" value="1024"/>
			<param name="fps" value="30"/>
			<param name="frame_id" value="left"/>

			<param name="exposure_absolute" value="90"/>
		</node>

		<node pkg="uvc_camera" type="uvc_camera_node" name="right">
			<remap from="image_raw" to="right/image_raw" />
			<remap from="camera_info" to="right/camera_info" />
			<remap from="camera" to="right" />

			<param name="device" value="/dev/video0"/>
			<param name="camera_info_url" value="file://$(find carrt_goggles)/launch/right.yaml"/>

			<param name="width" value="1280"/>
			<param name="height" value="1024"/>
			<param name="fps" value="30"/>
			<param name="frame_id" value="right"/>

			<param name="exposure_absolute" value="90"/>
		</node>

		<node pkg="nodelet" type="nodelet" args="standalone image_proc/crop_decimate" name="left_cropper">
			<param name="x_offset" value="150" />
			<param name="y_offset" value="150" />
			<param name="width" value="980" />
			<param name="height" value="724" />

			<remap from="camera/image_raw" to="left/image_raw"/>
			<remap from="camera/image_info" to="left/camera_info"/>

			<remap from="camera_out/image_raw" to="left/cropped/image_raw"/>
			<remap from="camera_out/image_info" to="left/cropped/camera_info"/>
		</node>

		<node pkg="nodelet" type="nodelet" args="standalone image_proc/crop_decimate" name="right_cropper">
			<param name="x_offset" value="150" />
			<param name="y_offset" value="150" />
			<param name="width" value="980" />
			<param name="height" value="724" />

			<remap from="camera/image_raw" to="right/image_raw"/>
			<remap from="camera/image_info" to="right/camera_info"/>

			<remap from="camera_out/image_raw" to="right/cropped/image_raw"/>
			<remap from="camera_out/image_info" to="right/cropped/camera_info"/>
		</node>

		<node name="stereo_image_proc" pkg="stereo_image_proc" type="stereo_image_proc">
			<remap from="left/image_raw" to="left/cropped/image_raw"/>
			<remap from="left/camera_info" to="left/camera_info"/>
			<remap from="right/image_raw" to="right/cropped/image_raw"/>
			<remap from="right/camera_info" to="right/camera_info"/>

			<param name="approximate_sync" value="true"/>
			
			<param name="prefilter_size" value="5"/>
			<param name="prefilter_cap" value="1"/>
			<param name="correlation_window_size" value="20"/>
			<param name="min_disparity" value="0"/>
			<param name="disparity_range" value="48"/>
			<param name="uniqueness_ratio" value="5.0"/>
			<param name="texture_threshold" value="0"/>
			<param name="speckle_size" value="200"/>
		</node>

		<!--node pkg="carrt_goggles" type="obstacle_detector" name="obstacle_detector" /-->

		<!--node pkg="carrt_goggles" type="ground_plane" name="ground_plane" >
			<param name="visualize" type="bool" value="true" />
		</node-->
	</group>

	<node name="stereo_view" pkg="image_view" type="stereo_view">
		<remap from="image" to="image_rect_color"/>
	</node>

	<node pkg="rviz" type="rviz" name="rviz" args="-d $(find carrt_goggles)/launch/usb_cam.rviz" />
</launch>